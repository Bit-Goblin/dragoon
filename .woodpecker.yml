pipeline:
  test:
    image: maven:3-jdk-11
    commands:
      - apt update && apt install -y lsof
      - mvn test

  build:
    image: maven:3-jdk-11
    commands:
      - mvn clean compile assembly:single

  gitea_release:
    image: plugins/gitea-release
    settings:
      api_key:
        from_secret: gitea_api_key
      base_url: https://git.metaunix.net
      title: "${CI_COMMIT_TAG}"
      files:
        - target/Dragoon-*.jar
    when:
      event: tag
